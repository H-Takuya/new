<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>銀河系シミュレーター ✦ Minimal & Cinematic</title>
  <style>
    html,body{height:100%;margin:0;overflow:hidden;background:#000;}
    canvas{display:block;width:100%;height:100%;cursor:crosshair}
  </style>
</head>
<body>
  <canvas id="sim"></canvas>
  <script>
    /*––––– CANVAS SETUP –––––*/
    const canvas=document.getElementById('sim');
    const ctx=canvas.getContext('2d');
    const DPR=window.devicePixelRatio||1;
    let W,H,CX,CY;
    const resize=()=>{W=window.innerWidth;H=window.innerHeight;CX=W/2;CY=H/2;
      canvas.width=W*DPR;canvas.height=H*DPR;canvas.style.width=W+'px';canvas.style.height=H+'px';ctx.setTransform(DPR,0,0,DPR,0,0);
    };resize();window.addEventListener('resize',resize);

    /*––––– UTILITIES –––––*/
    const rand=(a,b)=>Math.random()*(b-a)+a;
    const TAU=Math.PI*2;

    /*––––– STATIC STARFIELD –––––*/
    const backgroundStars=Array.from({length:300},()=>({
      x:rand(0,W),y:rand(0,H),r:rand(.2,1.6),phase:rand(0,TAU),spd:rand(.4,1.2),baseA:rand(.2,.9)
    }));

    /*––––– DYNAMIC GALACTIC DISK –––––*/
    const spiralStars=[]; // stars in spiral arms
    const ARM_COUNT=3, STAR_PER_ARM=450;
    for(let a=0;a<ARM_COUNT;a++){
      for(let i=0;i<STAR_PER_ARM;i++){
        const radius=i/STAR_PER_ARM*600*rand(.6,1.2);
        const angle=a*(TAU/ARM_COUNT)+radius*0.03+rand(-.1,.1);
        spiralStars.push({r:radius,theta:angle,speed:rand(.0004,.0009),size:rand(.6,1.8),hue:rand(180,260)});
      }
    }

    /*––––– PLANETS & SUN –––––*/
    class Body{constructor(o){Object.assign(this,o);} pos(){return {x:CX+Math.cos(this.a)*this.d,y:CY+Math.sin(this.a)*this.d};}}
    const planets=[
      new Body({n:'水星',c:'#a9a9a9',sz:3,d:60 ,spd:.006,a:0}),
      new Body({n:'金星',c:'#e0c16c',sz:4,d:100,spd:.0045,a:0}),
      new Body({n:'地球',c:'#4fc3f7',sz:4.5,d:150,spd:.0035,a:0}),
      new Body({n:'火星',c:'#ff7043',sz:3.5,d:210,spd:.0028,a:0}),
      new Body({n:'木星',c:'#fbc02d',sz:8 ,d:300,spd:.0015,a:0}),
      new Body({n:'土星',c:'#d1c4e9',sz:7 ,d:400,spd:.001 ,a:0}),
      new Body({n:'天王星',c:'#80cbc4',sz:6 ,d:500,spd:.0007,a:0}),
      new Body({n:'海王星',c:'#bcaaa4',sz:5.8,d:600,spd:.0005,a:0})
    ];

    /*––––– METEOR & SUPERNOVA –––––*/
    let meteor=null, supernova=null;
    function spawnMeteor(){meteor={x:-100,y:rand(0,H),v:rand(4,8),a:rand(-.1,.1),r:rand(4,6),tail:[]};}
    function triggerSupernova(){supernova={x:rand(CX-300,CX+300),y:rand(CY-300,CY+300),t:0};}
    setInterval(spawnMeteor,10000);setInterval(triggerSupernova,25000);

    /*––––– MAIN LOOP –––––*/
    let last=performance.now();
    function loop(now){const dt=Math.min((now-last)/1000,0.033);last=now;ctx.clearRect(0,0,W,H);

      // background stars
      backgroundStars.forEach(s=>{const a=s.baseA*(.5+.5*Math.sin(now*0.001*s.spd+s.phase));ctx.fillStyle=`rgba(255,255,255,${a})`;ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,TAU);ctx.fill();});

      // spiral arms
      spiralStars.forEach(s=>{s.theta+=s.speed;const x=CX+Math.cos(s.theta)*s.r,y=CY+Math.sin(s.theta)*s.r;
        ctx.fillStyle=`hsl(${s.hue},60%,85%)`;ctx.beginPath();ctx.arc(x,y,s.size,0,TAU);ctx.fill();});

      // Sun
      const pulse=1+0.05*Math.sin(now*0.002),sunR=20*pulse;const g=ctx.createRadialGradient(CX,CY,0,CX,CY,sunR);
      g.addColorStop(0,'#fff');g.addColorStop(.4,'#fff4b0');g.addColorStop(.8,'#ffca28');g.addColorStop(1,'#ff9800');ctx.fillStyle=g;
      ctx.beginPath();ctx.arc(CX,CY,sunR,0,TAU);ctx.fill();

      // planets
      planets.forEach(p=>{p.a+=p.spd;const {x,y}=p.pos();ctx.fillStyle=p.c;
        ctx.beginPath();ctx.arc(x,y,p.sz,0,TAU);ctx.fill();});

      // meteor
      if(meteor){meteor.x+=Math.cos(meteor.a)*meteor.v;meteor.y+=Math.sin(meteor.a)*meteor.v;meteor.tail.push({x:meteor.x,y:meteor.y});if(meteor.tail.length>25)meteor.tail.shift();
        // draw tail
        meteor.tail.forEach((pt,i)=>{const alpha=i/meteor.tail.length*.5;ctx.fillStyle=`rgba(255,165,0,${alpha})`;ctx.beginPath();ctx.arc(pt.x,pt.y,meteor.r*(i/meteor.tail.length),0,TAU);ctx.fill();});
        // head
        const headGrad=ctx.createRadialGradient(meteor.x,meteor.y,0,meteor.x,meteor.y,meteor.r);headGrad.addColorStop(0,'#fff');headGrad.addColorStop(1,'orange');ctx.fillStyle=headGrad;ctx.beginPath();ctx.arc(meteor.x,meteor.y,meteor.r,0,TAU);ctx.fill();
        // remove if off screen
        if(meteor.x>W+120||meteor.y>H+120||meteor.x<-120||meteor.y<-120)meteor=null;}

      // supernova
      if(supernova){supernova.t+=dt;const t=supernova.t;const radius=10+200*t;const alpha=Math.max(1-t,0);if(alpha>0){ctx.strokeStyle=`rgba(255,255,0,${alpha})`;ctx.lineWidth=2;ctx.beginPath();ctx.arc(supernova.x,supernova.y,radius,0,TAU);ctx.stroke();} else supernova=null;}

      requestAnimationFrame(loop);
    }requestAnimationFrame(loop);
  </script>
</body>
</html>
