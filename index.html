<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>éŠ€æ²³ç³»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆæ¼”å‡ºå¼·åŒ–ç‰ˆï¼‰</title>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* ãƒ•ã‚©ãƒ³ãƒˆå¤‰æ›´ */
    }
    canvas {
      display: block;
      margin: 0 auto;
      /* èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å°‘ã—èª¿æ•´ */
      background: radial-gradient(circle at center, #050505 0%, #0a0a10 70%, #101015 100%);
    }
    #timestamp {
      position: fixed;
      top: 15px; /* ä½ç½®èª¿æ•´ */
      left: 15px; /* ä½ç½®èª¿æ•´ */
      color: #e0e0e0; /* è‰²èª¿æ•´ */
      font-size: 18px; /* ã‚µã‚¤ã‚ºèª¿æ•´ */
      background: rgba(0, 0, 0, 0.7); /* èƒŒæ™¯èª¿æ•´ */
      padding: 8px 15px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°èª¿æ•´ */
      border-radius: 5px; /* è§’ä¸¸èª¿æ•´ */
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5); /* æ–‡å­—ã«å½± */
    }
    #history {
      position: fixed;
      top: 15px; /* ä½ç½®èª¿æ•´ */
      right: 15px; /* ä½ç½®èª¿æ•´ */
      max-height: calc(100% - 30px); /* é«˜ã•ã‚’èª¿æ•´ */
      overflow-y: auto;
      font-size: 12px; /* ã‚µã‚¤ã‚ºèª¿æ•´ */
      background: rgba(10, 10, 20, 0.5); /* èƒŒæ™¯è‰²èª¿æ•´ */
      padding: 10px 15px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°èª¿æ•´ */
      border-radius: 5px; /* è§’ä¸¸èª¿æ•´ */
      white-space: pre-line;
      color: rgba(200, 200, 255, 0.7); /* è‰²èª¿æ•´ */
      font-style: normal; /* ã‚¤ã‚¿ãƒªãƒƒã‚¯è§£é™¤ */
      border: 1px solid rgba(255, 255, 255, 0.1); /* æ ç·šè¿½åŠ  */
      max-width: 300px; /* æœ€å¤§å¹…è¨­å®š */
    }
    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #history::-webkit-scrollbar {
        width: 5px;
    }
    #history::-webkit-scrollbar-track {
        background: rgba(0,0,0,0.3);
        border-radius: 5px;
    }
    #history::-webkit-scrollbar-thumb {
        background: rgba(255,255,255,0.3);
        border-radius: 5px;
    }
    #history::-webkit-scrollbar-thumb:hover {
        background: rgba(255,255,255,0.5);
    }
  </style>
</head>
<body>
  <div id="timestamp">Loading...</div>
  <div id="history">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´</div> <canvas id="sim"></canvas>

  <script>
    const canvas = document.getElementById("sim");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let centerX = canvas.width / 2;
    let centerY = canvas.height / 2;

    const timestampEl = document.getElementById("timestamp");
    const historyEl = document.getElementById("history");
    const startDate = new Date("2025-01-01T00:00:00");
    let elapsedDays = 0;
    let history = ["ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹: " + startDate.toLocaleString()]; // åˆæœŸå±¥æ­´è¿½åŠ 
    historyEl.textContent = history.join('\n'); // åˆæœŸè¡¨ç¤º

    // --- æ˜Ÿå±‘é–¢é€£ ---
    const numStars = 500; // æ˜Ÿã®æ•°
    let stars = [];

    function generateStars() {
        stars = [];
        for (let i = 0; i < numStars; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: Math.random() * 1.2, // æ˜Ÿã®ã‚µã‚¤ã‚º
                alpha: 0.3 + Math.random() * 0.5 // æ˜Ÿã®æ˜ã‚‹ã•
            });
        }
    }

    function drawStars() {
        stars.forEach(star => {
            ctx.beginPath();
            ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(255, 255, 255, ${star.alpha})`;
            ctx.fill();
        });
    }
    // ---------------

    function updateTime() {
      elapsedDays += 0.05; // æ™‚é–“çµŒéé€Ÿåº¦ã¯ãã®ã¾ã¾
      const newDate = new Date(startDate.getTime() + elapsedDays * 86400000);
      timestampEl.textContent = `æ—¥ä»˜: ${newDate.toLocaleDateString()} ${newDate.toLocaleTimeString()}`; // è¡¨ç¤ºå½¢å¼å¤‰æ›´
    }

    function logEvent(message) { // æ±ç”¨ãƒ­ã‚°é–¢æ•°
      const now = new Date(startDate.getTime() + elapsedDays * 86400000);
      const dateStr = now.toLocaleString();
      history.unshift(`[${dateStr}] ${message}`);
      if (history.length > 50) { // å±¥æ­´ã®æœ€å¤§æ•°ã‚’åˆ¶é™
        history.pop();
      }
      historyEl.textContent = history.join('\n');
    }

    const FADE_SPEED = 0.01;

    let blackHole = {
      x: 0,
      y: 0,
      radius: 50,
      active: false,
      angle: 0,
      opacity: 0,
      fadingOut: false,
      timeoutId: null,
      attractionRadius: 250, // å¸å¼•ç¯„å›²ã‚’å°‘ã—åºƒã’ã‚‹
      pullStrength: 0.0008 // å¸å¼•åŠ›ã‚’èª¿æ•´å¯èƒ½ã«
    };

    let spaceship = {
      x: centerX,
      y: centerY,
      vx: 0,
      vy: 0,
      active: false
    };

    function spawnBlackHole() {
      if (blackHole.timeoutId) clearTimeout(blackHole.timeoutId);

      blackHole.x = Math.random() * canvas.width * 0.8 + canvas.width * 0.1; // ç”»é¢ç«¯ã™ããªã„ã‚ˆã†ã«èª¿æ•´
      blackHole.y = Math.random() * canvas.height * 0.8 + canvas.height * 0.1; // ç”»é¢ç«¯ã™ããªã„ã‚ˆã†ã«èª¿æ•´
      blackHole.radius = 40 + Math.random() * 20; // ã‚µã‚¤ã‚ºç¯„å›²èª¿æ•´
      blackHole.active = true;
      blackHole.opacity = 0;
      blackHole.fadingOut = false;
      blackHole.angle = 0;
      blackHole.attractionRadius = 200 + Math.random() * 100; // æ¯å›å¸å¼•ç¯„å›²ã‚’å¤‰ãˆã‚‹
      blackHole.pullStrength = 0.0006 + Math.random() * 0.0004; // æ¯å›å¸å¼•åŠ›ã‚’å¤‰ãˆã‚‹

      logEvent(`ğŸ•³ï¸ ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«å‡ºç¾ (${Math.round(blackHole.x)}, ${Math.round(blackHole.y)})`);

      const duration = 15000 + Math.random() * 10000; // æŒç¶šæ™‚é–“ç¯„å›²èª¿æ•´
      blackHole.timeoutId = setTimeout(() => {
        blackHole.fadingOut = true;
        logEvent(`â³ ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«æ¶ˆæ»…é–‹å§‹`);
      }, duration - 3000); // æ¶ˆæ»…é–‹å§‹æ™‚é–“ã‚’å°‘ã—æ—©ã‚ã‚‹

      // å®‡å®™èˆ¹é€ƒèµ°ã‚¹ã‚¿ãƒ¼ãƒˆ (ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã‹ã‚‰é›¢ã‚Œã‚‹æ–¹å‘ã«)
      spaceship.x = centerX;
      spaceship.y = centerY;
      const escapeAngle = Math.atan2(centerY - blackHole.y, centerX - blackHole.x);
      const escapeSpeed = 3 + Math.random() * 2;
      spaceship.vx = Math.cos(escapeAngle) * escapeSpeed;
      spaceship.vy = Math.sin(escapeAngle) * escapeSpeed;
      spaceship.active = true;
      logEvent(`ğŸš€ å®‡å®™èˆ¹ç·Šæ€¥è„±å‡ºé–‹å§‹`);
    }

    spawnBlackHole(); // æœ€åˆã«å¿…ãšç”Ÿæˆ
    setInterval(spawnBlackHole, 20000 + Math.random() * 10000); // ç”Ÿæˆé–“éš”ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«

    const colors = ["#a9a9a9", "#e0c16c", "#4fc3f7", "#ff7043", "#fbc02d", "#d1c4e9", "#80cbc4", "#bcaaa4", "#a5d6a7"]; // è‰²è¿½åŠ 
    const names = ["æ°´æ˜Ÿ", "é‡‘æ˜Ÿ", "åœ°çƒ", "ç«æ˜Ÿ", "æœ¨æ˜Ÿ", "åœŸæ˜Ÿ", "å¤©ç‹æ˜Ÿ", "æµ·ç‹æ˜Ÿ", "å†¥ç‹æ˜Ÿ"]; // åå‰è¿½åŠ  (æ—¥æœ¬èªåŒ–)
    let planets = [];

    function generatePlanets() {
      planets = [];
      const numPlanets = 9; // æƒ‘æ˜Ÿæ•°å¤‰æ›´
      for (let i = 0; i < numPlanets; i++) {
        const distance = 60 + i * 45; // è·é›¢èª¿æ•´
        const angle = Math.random() * Math.PI * 2;
        const speed = 0.005 + (i * 0.0012); // é€Ÿåº¦èª¿æ•´
        const planetData = {
          name: names[i],
          angle,
          distance,
          speed,
          radius: 3 + i * 1.2, // ã‚µã‚¤ã‚ºèª¿æ•´
          color: colors[i % colors.length],
          moons: [],
          originalDistance: distance, // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«å½±éŸ¿è¨ˆç®—ç”¨
          originalSpeed: speed      // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«å½±éŸ¿è¨ˆç®—ç”¨
        };
        // æœˆã‚’è¿½åŠ  (åœ°çƒã¨æœ¨æ˜Ÿã€åœŸæ˜Ÿã«)
        if (i === 2 || i === 4 || i === 5) {
          const numMoons = i === 2 ? 1 : (i === 4 ? 2 : 3); // æƒ‘æ˜Ÿã«å¿œã˜ãŸæœˆã®æ•°
          for(let m = 0; m < numMoons; m++) {
              planetData.moons.push({
                name: `è¡›æ˜Ÿ${m+1}`,
                distance: planetData.radius + 10 + m * 5, // æœˆã®è·é›¢
                angle: Math.random() * Math.PI * 2,
                speed: 0.03 + Math.random() * 0.04, // æœˆã®é€Ÿåº¦
                radius: 1 + Math.random(), // æœˆã®ã‚µã‚¤ã‚º
                color: "#cccccc"
              });
          }
        }
        // åœŸæ˜Ÿã®è¼ª
        if (i === 5) {
            planetData.ring = { color: "rgba(210, 190, 170, 0.5)", radius: planetData.radius + 10 };
        }

        planets.push(planetData);
      }
       logEvent("ğŸª æƒ‘æ˜Ÿç³»å†ç”Ÿæˆå®Œäº†");
    }

    generatePlanets();

    let meteor = {
      x: -100,
      y: Math.random() * canvas.height,
      speed: 5 + Math.random() * 5, // é€Ÿåº¦ç¯„å›²èª¿æ•´
      radius: 5 + Math.random() * 10, // ã‚µã‚¤ã‚ºç¯„å›²èª¿æ•´
      active: true,
      angle: Math.atan2(Math.random() * canvas.height - canvas.height/2, canvas.width), // è§’åº¦ã‚’è¿½åŠ 
      tail: [] // è»Œè·¡ç”¨é…åˆ—
    };

    function resetMeteor() {
      meteor.x = -meteor.radius; // é–‹å§‹ä½ç½®èª¿æ•´
      meteor.y = Math.random() * canvas.height;
      meteor.speed = 5 + Math.random() * 5;
      meteor.radius = 5 + Math.random() * 10;
      meteor.angle = Math.atan2(Math.random() * canvas.height - meteor.y, canvas.width - meteor.x); // æ–°ã—ã„è§’åº¦
      meteor.active = true;
      meteor.tail = []; // è»Œè·¡ãƒªã‚»ãƒƒãƒˆ
      //logEvent("ğŸŒ  æ–°ã—ã„æµæ˜ŸãŒå‡ºç¾"); // é »ç¹ã™ãã‚‹ã®ã§ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚‚å¯
    }

    // ä¸€å®šé–“éš”ã§æµæ˜Ÿã‚’ãƒªã‚»ãƒƒãƒˆ
    setInterval(resetMeteor, 8000 + Math.random() * 5000);

    function drawSpaceship() {
      if (!spaceship.active) return;
      spaceship.x += spaceship.vx;
      spaceship.y += spaceship.vy;
      // ç”»é¢å¤–ã«å‡ºãŸã‚‰éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
      if (spaceship.x < -50 || spaceship.x > canvas.width + 50 || spaceship.y < -50 || spaceship.y > canvas.height + 50) {
        spaceship.active = false;
        logEvent("ğŸš€ å®‡å®™èˆ¹ã¯éŠ€æ²³å¤–ã¸è„±å‡ºæˆåŠŸ");
        return;
      }

      // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã®å½±éŸ¿ã‚’å—ã‘ã‚‹
      if (blackHole.active && blackHole.opacity > 0.1) {
         const dx = blackHole.x - spaceship.x;
         const dy = blackHole.y - spaceship.y;
         const distSq = dx * dx + dy * dy;
         const pullRadiusSq = blackHole.attractionRadius * blackHole.attractionRadius * 0.5; // å®‡å®™èˆ¹ã¸ã®å½±éŸ¿ç¯„å›²ã¯ç‹­ã‚ã«

         if (distSq < pullRadiusSq) {
             const dist = Math.sqrt(distSq);
             const force = (pullRadiusSq - distSq) / pullRadiusSq * blackHole.pullStrength * 100 * blackHole.opacity; // åŠ›ã‚’èª¿æ•´
             spaceship.vx += (dx / dist) * force;
             spaceship.vy += (dy / dist) * force;
         }
          // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã«æ¥è§¦ã—ãŸã‚‰ç ´å£Š
         if (distSq < (blackHole.radius * blackHole.radius)) {
             spaceship.active = false;
             logEvent("ğŸ’¥ å®‡å®™èˆ¹ãŒãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã«æ•ç²ã•ã‚ŒãŸï¼");
             // ã“ã“ã§çˆ†ç™ºã‚¨ãƒ•ã‚§ã‚¯ãƒˆãªã©ã‚’è¿½åŠ ã—ã¦ã‚‚è‰¯ã„
             return;
         }
      }


      ctx.save();
      ctx.translate(spaceship.x, spaceship.y);
      ctx.rotate(Math.atan2(spaceship.vy, spaceship.vx) + Math.PI / 2); // å‘ãã‚’é€²è¡Œæ–¹å‘ã«åˆã‚ã›ã‚‹
      ctx.fillStyle = "white";
      ctx.shadowColor = "cyan"; // ç™ºå…‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      ctx.shadowBlur = 10;

      // å®‡å®™èˆ¹ã®å½¢ã‚’æç”»
      ctx.beginPath();
      ctx.moveTo(0, -10); // å…ˆç«¯
      ctx.lineTo(5, 5);  // å³ç¿¼
      ctx.lineTo(0, 2);  // å°¾éƒ¨ä¸­å¤®
      ctx.lineTo(-5, 5); // å·¦ç¿¼
      ctx.closePath();
      ctx.fill();

      // ã‚¨ãƒ³ã‚¸ãƒ³å™´å°„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      ctx.fillStyle = `rgba(255, 150, 0, ${0.5 + Math.random() * 0.5})`; // ã‚ªãƒ¬ãƒ³ã‚¸ç³»ã®è‰²ã§ç‚¹æ»…
      ctx.beginPath();
      ctx.moveTo(0, 3);
      ctx.lineTo(2, 7 + Math.random() * 3);
      ctx.lineTo(-2, 7 + Math.random() * 3);
      ctx.closePath();
      ctx.fill();

      ctx.restore();
    }

    function drawBlackHole() {
      if (!blackHole.active || blackHole.opacity <= 0) return;

      ctx.save();
      ctx.globalAlpha = blackHole.opacity;

      blackHole.angle += 0.02; // å›è»¢é€Ÿåº¦
      ctx.translate(blackHole.x, blackHole.y);

      // é™ç€å††ç›¤ (Accretion Disk) ã®ã‚ˆã†ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      const diskRadius = blackHole.radius * 3;
      const gradientDisk = ctx.createRadialGradient(0, 0, blackHole.radius * 0.8, 0, 0, diskRadius);
      gradientDisk.addColorStop(0, `rgba(0, 0, 0, 0)`); // ä¸­å¿ƒä»˜è¿‘ã¯é€æ˜ã«
      gradientDisk.addColorStop(0.3, `rgba(255, 100, 0, ${0.4 * blackHole.opacity})`); // å†…å´ã¯ã‚ªãƒ¬ãƒ³ã‚¸ã£ã½ã
      gradientDisk.addColorStop(0.6, `rgba(150, 50, 255, ${0.3 * blackHole.opacity})`); // å¤–å´ã¯ç´«ã£ã½ã
      gradientDisk.addColorStop(1, `rgba(0, 0, 0, 0)`);

      ctx.rotate(blackHole.angle * 0.5); // å††ç›¤ã¯å°‘ã—ã‚†ã£ãã‚Šå›è»¢
      ctx.fillStyle = gradientDisk;
      ctx.beginPath();
      // ãƒ‰ãƒ¼ãƒŠãƒ„çŠ¶ã«ã™ã‚‹ãŸã‚ã€å¤§ããªå††ã‹ã‚‰å°ã•ã„å††ã‚’åˆ‡ã‚ŠæŠœããƒ‘ã‚¹ã‚’ä½¿ã†
      ctx.arc(0, 0, diskRadius, 0, Math.PI * 2);
      ctx.arc(0, 0, blackHole.radius * 0.7, 0, Math.PI * 2, true); // åæ™‚è¨ˆå›ã‚Šã§å†…å††
      ctx.fill();
      ctx.rotate(-blackHole.angle * 0.5);


       // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«æœ¬ä½“ï¼ˆä¸­å¿ƒã®é»’ã„å††ï¼‰
      ctx.rotate(blackHole.angle); // æœ¬ä½“ã¯é€Ÿãå›è»¢
      ctx.fillStyle = "black";
      ctx.shadowColor = "magenta"; // å½±ã®è‰²ã§ç¸ã‚’å¼·èª¿
      ctx.shadowBlur = 20 * blackHole.opacity;
      ctx.beginPath();
      ctx.arc(0, 0, blackHole.radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowColor = "transparent"; // å½±ã‚’ãƒªã‚»ãƒƒãƒˆ
      ctx.rotate(-blackHole.angle);

      // ã‚·ãƒ¥ãƒãƒ«ãƒ„ã‚·ãƒ«ãƒˆåŠå¾„ã®ã‚ˆã†ãªå¢ƒç•Œç·š (ç‚¹æ»…)
      const pulse = 0.8 + 0.2 * Math.sin(Date.now() * 0.008);
      ctx.strokeStyle = `rgba(255, 255, 255, ${0.4 * pulse * blackHole.opacity})`;
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.arc(0, 0, blackHole.radius + 2, 0, Math.PI * 2);
      ctx.stroke();

      ctx.restore(); // globalAlpha ãªã©ã‚‚å…ƒã«æˆ»ã™

      // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã®ãƒ©ãƒ™ãƒ«è¡¨ç¤ºï¼ˆopacityã«é€£å‹•ï¼‰
      ctx.fillStyle = `rgba(255, 255, 255, ${0.8 * blackHole.opacity})`;
      ctx.font = "14px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("Black Hole", blackHole.x, blackHole.y - blackHole.radius - 20); // ä½ç½®èª¿æ•´
      ctx.textAlign = "start";
    }

    function drawMeteor() {
        if (!meteor.active) return;

        // è»Œè·¡ã®æ›´æ–°
        meteor.tail.push({ x: meteor.x, y: meteor.y, radius: meteor.radius });
        if (meteor.tail.length > 20) { // è»Œè·¡ã®æœ€å¤§é•·
            meteor.tail.shift();
        }

        meteor.x += Math.cos(meteor.angle) * meteor.speed;
        meteor.y += Math.sin(meteor.angle) * meteor.speed;

        if (meteor.x > canvas.width + meteor.radius * 2 || meteor.y < -meteor.radius * 2 || meteor.y > canvas.height + meteor.radius * 2 ) {
            meteor.active = false; // ç”»é¢å¤–ã«å‡ºãŸã‚‰éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
        } else {
            // è»Œè·¡ã®æç”»
            for (let i = 0; i < meteor.tail.length; i++) {
                const point = meteor.tail[i];
                const alpha = (i / meteor.tail.length) * 0.5; // å°¾ã«è¡Œãã»ã©è–„ã
                const radius = point.radius * (i / meteor.tail.length); // å°¾ã«è¡Œãã»ã©ç´°ã
                ctx.beginPath();
                ctx.arc(point.x, point.y, radius, 0, Math.PI * 2);
                // å°¾ã®è‰²ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ã‹ã‚‰é»„è‰²ã¸ï¼‰
                const r = 255;
                const g = 165 + (255 - 165) * (i / meteor.tail.length);
                const b = 0;
                ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${alpha})`;
                ctx.fill();
            }

            // æµæ˜Ÿæœ¬ä½“ã®æç”»
            ctx.beginPath();
            const meteorGradient = ctx.createRadialGradient(meteor.x, meteor.y, 0, meteor.x, meteor.y, meteor.radius);
            meteorGradient.addColorStop(0, "white");
            meteorGradient.addColorStop(0.4, "yellow");
            meteorGradient.addColorStop(1, "orange");
            ctx.fillStyle = meteorGradient;
            ctx.shadowColor = "red"; // ç™ºå…‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            ctx.shadowBlur = 15;
            ctx.arc(meteor.x, meteor.y, meteor.radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowColor = "transparent"; // å½±ãƒªã‚»ãƒƒãƒˆ
        }
    }

    function update() {
      // --- æç”»å‡¦ç† ---
      // ç”»é¢ã‚¯ãƒªã‚¢ (åŠé€æ˜ã®é»’ã§ä¸Šæ›¸ãã—ã¦è»Œè·¡ã‚’è¡¨ç¾)
      ctx.fillStyle = "rgba(0, 0, 0, 0.25)"; // å°‘ã—æ¿ƒãã—ã¦æ®‹åƒæ„Ÿã‚’èª¿æ•´
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // æ˜Ÿå±‘ã‚’æç”»
      drawStars();

      // å¤ªé™½ã®æç”»
      const pulse = 1 + 0.05 * Math.sin(Date.now() * 0.002); // è„ˆå‹•ã‚’å°‘ã—æŠ‘ãˆã‚‹
      const sunRadius = 20 * pulse;

      // å¤ªé™½ã‚³ãƒ­ãƒŠ (å¤–å´ã®å…‰è¼ª)
      const coronaRadius = sunRadius * 2.5;
      const coronaGradient = ctx.createRadialGradient(centerX, centerY, sunRadius * 0.8, centerX, centerY, coronaRadius);
      coronaGradient.addColorStop(0, `rgba(255, 255, 200, 0.3)`);
      coronaGradient.addColorStop(0.5, `rgba(255, 200, 150, 0.1)`);
      coronaGradient.addColorStop(1, `rgba(255, 150, 0, 0)`);
      ctx.fillStyle = coronaGradient;
      ctx.beginPath();
      ctx.arc(centerX, centerY, coronaRadius, 0, Math.PI * 2);
      ctx.fill();

      // å¤ªé™½æœ¬ä½“
      const sunGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, sunRadius);
      sunGradient.addColorStop(0, "#ffffff");
      sunGradient.addColorStop(0.4, "#fff0a0"); // è‰²èª¿æ•´
      sunGradient.addColorStop(0.8, "#ffcc00"); // è‰²èª¿æ•´
      sunGradient.addColorStop(1, "#ff9900");
      ctx.fillStyle = sunGradient;
      ctx.shadowColor = "yellow"; // å¤ªé™½ã®è¼ã
      ctx.shadowBlur = 30 * pulse;
      ctx.beginPath();
      ctx.arc(centerX, centerY, sunRadius, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowColor = "transparent"; // å½±ãƒªã‚»ãƒƒãƒˆ

      // å¤ªé™½ãƒ©ãƒ™ãƒ«
      ctx.fillStyle = "#fff";
      ctx.font = "14px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("å¤ªé™½", centerX, centerY + sunRadius + 15); // ä½ç½®èª¿æ•´
      ctx.textAlign = "start";

      // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã®çŠ¶æ…‹æ›´æ–°ã¨æç”»
      if (blackHole.active) {
        if (!blackHole.fadingOut && blackHole.opacity < 1) {
          blackHole.opacity = Math.min(1, blackHole.opacity + FADE_SPEED);
        } else if (blackHole.fadingOut) {
          blackHole.opacity = Math.max(0, blackHole.opacity - FADE_SPEED);
          if (blackHole.opacity <= 0) {
            blackHole.active = false;
            blackHole.timeoutId = null; // å¿µã®ãŸã‚ã‚¯ãƒªã‚¢
            logEvent("âš« ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«å®Œå…¨ã«æ¶ˆæ»…");
          }
        }
      }
      drawBlackHole(); // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«æç”»

      // æƒ‘æ˜Ÿã¨æœˆã®æ›´æ–°ãƒ»æç”»
      for (let i = planets.length - 1; i >= 0; i--) {
        const p = planets[i];
        p.angle += p.speed;
        let currentX = centerX + Math.cos(p.angle) * p.distance;
        let currentY = centerY + Math.sin(p.angle) * p.distance;
        let affectedByBlackHole = false;

        // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã®å½±éŸ¿è¨ˆç®—
        if (blackHole.active && blackHole.opacity > 0.1) {
          const dx_p = blackHole.x - currentX;
          const dy_p = blackHole.y - currentY;
          const distSq_p = dx_p * dx_p + dy_p * dy_p;
          const pullRadiusSq = blackHole.attractionRadius * blackHole.attractionRadius;

          if (distSq_p < pullRadiusSq) {
            affectedByBlackHole = true;
            const dist_p = Math.sqrt(distSq_p);
            // è·é›¢ã«å¿œã˜ã¦åŠ›ã‚’è¨ˆç®— (è¿‘ã¥ãã»ã©å¼·ã)
            const forceFactor = (pullRadiusSq - distSq_p) / pullRadiusSq; // 0~1ã®ç¯„å›²
            const force_p = forceFactor * blackHole.pullStrength * blackHole.opacity;

            // æƒ‘æ˜Ÿã®ä½ç½®ã‚’ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«æ–¹å‘ã«ç§»å‹•ã•ã›ã‚‹
            currentX += dx_p * force_p;
            currentY += dy_p * force_p;

            // æ–°ã—ã„ä½ç½®ã«åŸºã¥ã„ã¦ã€ä¸­å¿ƒã‹ã‚‰ã®è·é›¢ã¨è§’åº¦ã‚’å†è¨ˆç®—
            const dCenterX = currentX - centerX;
            const dCenterY = currentY - centerY;
            p.distance = Math.sqrt(dCenterX * dCenterX + dCenterY * dCenterY);
            p.angle = Math.atan2(dCenterY, dCenterX);

            // é€Ÿåº¦ã‚‚å¤‰åŒ–ã•ã›ã‚‹ï¼ˆæ¥ç·šæ–¹å‘ã®é€Ÿåº¦ã‚’è½ã¨ã—ã€ä¸­å¿ƒæ–¹å‘ã®é€Ÿåº¦ã‚’åŠ ãˆã‚‹ï¼‰
            // ç°¡å˜ãªå®Ÿè£…: è·é›¢ãŒç¸®ã‚€ã»ã©å…¬è»¢é€Ÿåº¦ãŒè½ã¡ã‚‹ã‚ˆã†ã«è¦‹ã›ã‚‹
             p.speed = p.originalSpeed * (p.distance / p.originalDistance);


             // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã«å¸ã„è¾¼ã¾ã‚ŒãŸã‚‰æƒ‘æ˜Ÿã‚’å‰Šé™¤
             if (dist_p < blackHole.radius + p.radius) {
                 logEvent(`ğŸ’¥ ${p.name} ãŒãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã«é£²ã¿è¾¼ã¾ã‚ŒãŸï¼`);
                 planets.splice(i, 1);
                 continue; // æ¬¡ã®æƒ‘æ˜Ÿã¸
             }
          } else {
             // å½±éŸ¿ç¯„å›²å¤–ã«å‡ºãŸã‚‰å…ƒã®è»Œé“ã«æˆ»ã‚‹ï¼ˆå¾ã€…ã«æˆ»ã™æ–¹ãŒè‡ªç„¶ã ãŒã€ç°¡æ˜“çš„ã«ï¼‰
             // p.distance = p.originalDistance;
             p.speed = p.originalSpeed;
          }
        } else {
             // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«éã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚ã¯å…ƒã®é€Ÿåº¦ã«æˆ»ã™
             p.speed = p.originalSpeed;
        }

        // æƒ‘æ˜Ÿã®è»Œé“æç”» (å½±éŸ¿ä¸‹ã«ã‚ã‚‹ã¨ãã¯å°‘ã—æºã‚‰ã™)
        ctx.beginPath();
        ctx.ellipse(centerX, centerY, p.distance, p.distance, 0, 0, Math.PI * 2); // æ­£å††è»Œé“
        ctx.strokeStyle = affectedByBlackHole ? `rgba(255, 100, 100, ${0.15 * blackHole.opacity})` : "rgba(255, 255, 255, 0.08)"; // å½±éŸ¿ä¸‹ãªã‚‰èµ¤ã£ã½ã
        ctx.lineWidth = affectedByBlackHole ? 1.5 : 1;
        ctx.stroke();

        // æƒ‘æ˜Ÿæœ¬ä½“æç”»
        ctx.beginPath();
        ctx.arc(currentX, currentY, p.radius, 0, Math.PI * 2);
        ctx.fillStyle = p.color;
        ctx.shadowColor = p.color; // æƒ‘æ˜Ÿè‡ªèº«ã®è‰²ã§ç™ºå…‰
        ctx.shadowBlur = p.radius * 1.5;
        ctx.fill();
        ctx.shadowColor = "transparent"; // å½±ãƒªã‚»ãƒƒãƒˆ

        // æƒ‘æ˜Ÿãƒ©ãƒ™ãƒ«
        ctx.fillStyle = "#ffffff";
        ctx.font = "11px sans-serif";
        ctx.fillText(p.name, currentX + p.radius + 5, currentY + 4);

        // åœŸæ˜Ÿã®è¼ªã‚’æç”»
        if (p.ring) {
            ctx.strokeStyle = p.ring.color;
            ctx.lineWidth = 2; // è¼ªã®å¤ªã•
            ctx.beginPath();
            ctx.save(); // åº§æ¨™ç³»ã‚’ä¿å­˜
            ctx.translate(currentX, currentY); // æƒ‘æ˜Ÿã®ä¸­å¿ƒã‚’åŸç‚¹ã«
            ctx.rotate(0.3); // è¼ªã‚’å°‘ã—å‚¾ã‘ã‚‹
            ctx.scale(1, 0.4); // æ¥•å††ã«è¦‹ã›ã‚‹ãŸã‚ã«Yè»¸ã‚’ç¸®å°
            ctx.arc(0, 0, p.ring.radius, 0, Math.PI * 2);
            ctx.stroke();
            ctx.restore(); // åº§æ¨™ç³»ã‚’å…ƒã«æˆ»ã™
        }


        // æœˆã®æ›´æ–°ãƒ»æç”»
        if (p.moons) {
          for (let j = p.moons.length - 1; j >= 0; j--) {
            const m = p.moons[j];
            m.angle += m.speed;
            let mx = currentX + Math.cos(m.angle) * m.distance;
            let my = currentY + Math.sin(m.angle) * m.distance;

            // æœˆã‚‚ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã®å½±éŸ¿ã‚’å—ã‘ã‚‹ (æƒ‘æ˜Ÿã‚ˆã‚Šå¼·ã)
            if (blackHole.active && blackHole.opacity > 0.1) {
              const dx_m = blackHole.x - mx;
              const dy_m = blackHole.y - my;
              const distSq_m = dx_m * dx_m + dy_m * dy_m;
              // æœˆã¸ã®å½±éŸ¿ç¯„å›²ã¯æƒ‘æ˜Ÿã‚ˆã‚Šå°‘ã—ç‹­ã„ãŒã€åŠ›ã¯å¼·ãã™ã‚‹
              const pullRadiusSq_m = blackHole.attractionRadius * blackHole.attractionRadius * 0.8;

              if (distSq_m < pullRadiusSq_m) {
                const dist_m = Math.sqrt(distSq_m);
                const forceFactor_m = (pullRadiusSq_m - distSq_m) / pullRadiusSq_m;
                const force_m = forceFactor_m * blackHole.pullStrength * 1.5 * blackHole.opacity; // æƒ‘æ˜Ÿã‚ˆã‚Šå¼·ã„åŠ›

                mx += dx_m * force_m;
                my += dy_m * force_m;

                // æ–°ã—ã„æœˆã¨æƒ‘æ˜Ÿé–“ã®è·é›¢ã¨è§’åº¦ã‚’è¨ˆç®—
                const dPlanetX = mx - currentX;
                const dPlanetY = my - currentY;
                m.distance = Math.sqrt(dPlanetX * dPlanetX + dPlanetY * dPlanetY);
                m.angle = Math.atan2(dPlanetY, dPlanetX);

                // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã«å¸ã„è¾¼ã¾ã‚ŒãŸã‚‰æœˆã‚’å‰Šé™¤
                if (dist_m < blackHole.radius + m.radius) {
                    logEvent(`ğŸ’¥ ${p.name}ã®${m.name} ãŒãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã«é£²ã¿è¾¼ã¾ã‚ŒãŸï¼`);
                    p.moons.splice(j, 1);
                    continue; // æ¬¡ã®æœˆã¸
                }
              }
            }

            // æœˆã®æç”»
            ctx.beginPath();
            ctx.arc(mx, my, m.radius, 0, Math.PI * 2);
            ctx.fillStyle = m.color;
            ctx.fill();
          }
        }
      }

       // æµæ˜Ÿã®æç”»
       drawMeteor();

       // å®‡å®™èˆ¹ã®æç”»
       drawSpaceship();

       // æ™‚é–“æ›´æ–°
       updateTime();

       // --- çŠ¶æ…‹ç®¡ç† ---
       // å…¨ã¦ã®æƒ‘æ˜ŸãŒãªããªã£ãŸã‚‰ãƒªã‚»ãƒƒãƒˆ
        if (planets.length === 0 && blackHole.opacity < 0.5) { // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ãŒæ¶ˆãˆã‹ã‘ãŸã‚‰å†ç”Ÿæˆ
            logEvent("â˜„ï¸ éŠ€æ²³æ»…äº¡...æ–°ãŸãªéŠ€æ²³ã‚’ç”Ÿæˆã—ã¾ã™ã€‚");
            generatePlanets();
            resetMeteor(); // æµæ˜Ÿã‚‚ãƒªã‚»ãƒƒãƒˆ
            // å®‡å®™èˆ¹ã‚‚ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã‹ã©ã†ã‹ï¼ˆå¿…è¦ãªã‚‰ï¼‰
            spaceship.active = false;
        }

    } // updateé–¢æ•°ã®çµ‚ã‚ã‚Š


    function animate() {
      update();
      requestAnimationFrame(animate);
    }

    // åˆæœŸåŒ–å‡¦ç†
    generateStars(); // æ˜Ÿå±‘ã‚’ç”Ÿæˆ
    animate(); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®å‡¦ç†
    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      centerX = canvas.width / 2;
      centerY = canvas.height / 2;
      generateStars(); // ãƒªã‚µã‚¤ã‚ºæ™‚ã«ã‚‚æ˜Ÿã‚’å†ç”Ÿæˆ
      // update(); // animateãŒå¸¸ã«å›ã£ã¦ã„ã‚‹ã®ã§ä¸è¦ãªå ´åˆãŒå¤šã„
    });

    // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    window.addEventListener('unload', () => {
      if (blackHole.timeoutId) clearTimeout(blackHole.timeoutId);
      // ä»–ã®ã‚¿ã‚¤ãƒãƒ¼ãŒã‚ã‚Œã°ã“ã“ã§ã‚¯ãƒªã‚¢
    });

  </script>
</body>
</html>
