<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>生命進化シミュレーター ✦ 1分で生物誕生から人類まで</title>
  <style>
    html, body { height: 100%; margin: 0; background: #111; overflow: hidden; font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; }
    canvas { display: block; width: 100vw; height: 100vh; background: #111; }
    #info { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(30,30,40,0.85); color: #fff; padding: 10px 24px; border-radius: 10px; font-size: 1.2em; z-index: 10; }
    #stats { position: fixed; bottom: 10px; right: 10px; background: rgba(10, 10, 30, 0.75); color: #cce; border: 1px solid rgba(120, 140, 255, 0.35); padding: 8px 12px; border-radius: 8px; font: 12px/1.45 monospace; box-shadow: 0 0 15px rgba(70, 130, 240, 0.35); pointer-events: none; z-index: 10; }
  </style>
</head>
<body>
  <canvas id="sim"></canvas>
  <div id="info">原始地球…</div>
  <div id="stats"></div>
  <script>
    // --- 設定 ---
    const cvs = document.getElementById("sim");
    const ctx = cvs.getContext("2d");
    let W = window.innerWidth, H = window.innerHeight;
    cvs.width = W; cvs.height = H;
    window.addEventListener("resize", () => { W = window.innerWidth; H = window.innerHeight; cvs.width = W; cvs.height = H; });

    // --- ステージ定義 ---
    const stages = [
      { name: "原始地球", duration: 3, color: "#444", desc: "海と火山の時代" },
      { name: "生命誕生", duration: 5, color: "#2e5d3a", desc: "単細胞生物の出現" },
      { name: "多細胞生物", duration: 7, color: "#3a7d5d", desc: "多細胞化・進化の加速" },
      { name: "魚類・両生類", duration: 7, color: "#2a5d7d", desc: "海から陸へ" },
      { name: "爬虫類・恐竜", duration: 7, color: "#7d5d2a", desc: "巨大生物の時代" },
      { name: "哺乳類・鳥類", duration: 7, color: "#7d3a5d", desc: "恐竜絶滅・哺乳類台頭" },
      { name: "霊長類", duration: 7, color: "#5d3a2e", desc: "サルからヒトへ" },
      { name: "人類誕生", duration: 7, color: "#e0c080", desc: "文明の始まり" },
      { name: "現代", duration: 5, color: "#b0b0b0", desc: "現代社会" }
    ];
    // 合計約55秒

    // --- エンティティ定義 ---
    class Entity {
      constructor(x, y, type) {
        this.x = x;
        this.y = y;
        this.type = type; // "cell", "fish", "dino", "mammal", "primate", "human"
        this.age = 0;
        this.dir = Math.random() * Math.PI * 2;
        this.size = 4 + Math.random() * 6;
        this.color = "#fff";
        this.setColor();
      }
      setColor() {
        switch(this.type) {
          case "cell": this.color = "#aaffaa"; break;
          case "fish": this.color = "#66ccff"; break;
          case "dino": this.color = "#eebb77"; break;
          case "mammal": this.color = "#ccccaa"; break;
          case "primate": this.color = "#ffcc99"; break;
          case "human": this.color = "#ffeedd"; break;
        }
      }
      update() {
        this.age++;
        // ランダムウォーク
        this.dir += (Math.random()-0.5)*0.2;
        this.x += Math.cos(this.dir) * 0.8;
        this.y += Math.sin(this.dir) * 0.8;
        // 画面端で跳ね返る
        if(this.x < 10 || this.x > W-10) this.dir = Math.PI - this.dir;
        if(this.y < 10 || this.y > H-10) this.dir = -this.dir;
      }
      draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.beginPath();
        if(this.type === "cell") {
          ctx.arc(0, 0, this.size, 0, Math.PI*2);
        } else if(this.type === "fish") {
          ctx.ellipse(0, 0, this.size*1.2, this.size*0.7, 0, 0, Math.PI*2);
        } else if(this.type === "dino") {
          ctx.ellipse(0, 0, this.size*1.5, this.size*0.9, 0, 0, Math.PI*2);
        } else if(this.type === "mammal" || this.type === "primate") {
          ctx.arc(0, 0, this.size, 0, Math.PI*2);
        } else if(this.type === "human") {
          ctx.arc(0, 0, this.size*0.7, 0, Math.PI*2);
          ctx.fillStyle = "#222";
          ctx.arc(0, -this.size*0.7, this.size*0.3, 0, Math.PI*2);
        }
        ctx.fillStyle = this.color;
        ctx.globalAlpha = 0.85;
        ctx.fill();
        ctx.restore();
      }
    }

    // --- シミュレーション管理 ---
    let stageIdx = 0, stageTime = 0, entities = [];
    const info = document.getElementById("info");
    const stats = document.getElementById("stats");

    function nextStage() {
      stageIdx++;
      if(stageIdx >= stages.length) stageIdx = stages.length-1;
      stageTime = 0;
      entities = [];
      spawnEntities();
    }

    function spawnEntities() {
      entities = [];
      let type = "cell";
      if(stageIdx === 0) return; // 原始地球は何も出さない
      if(stageIdx === 1) type = "cell";
      if(stageIdx === 2) type = "cell";
      if(stageIdx === 3) type = "fish";
      if(stageIdx === 4) type = "dino";
      if(stageIdx === 5) type = "mammal";
      if(stageIdx === 6) type = "primate";
      if(stageIdx === 7) type = "human";
      if(stageIdx === 8) type = "human";
      let count = 30;
      if(stageIdx === 7) count = 15;
      if(stageIdx === 8) count = 30;
      for(let i=0;i<count;i++) {
        entities.push(new Entity(
          Math.random()*W*0.8+W*0.1,
          Math.random()*H*0.8+H*0.1,
          type
        ));
      }
    }

    // --- メインループ ---
    function loop() {
      // 背景
      ctx.fillStyle = stages[stageIdx].color;
      ctx.fillRect(0,0,W,H);

      // エンティティ
      for(const e of entities) {
        e.update();
        e.draw();
      }

      // ステージ進行
      stageTime += 1/60;
      if(stageTime > stages[stageIdx].duration) {
        if(stageIdx < stages.length-1) {
          nextStage();
        }
      }

      // テキスト表示
      info.innerHTML = `<b>${stages[stageIdx].name}</b>　${stages[stageIdx].desc}`;
      stats.textContent = `時代: ${stages[stageIdx].name}　個体数: ${entities.length}　経過: ${Math.floor(stageTime)}秒`;

      requestAnimationFrame(loop);
    }

    // --- 初期化 ---
    spawnEntities();
    loop();
  </script>
</body>
</html>

