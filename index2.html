<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>シドー戦（再現）</title>
  <style>
    body {
      background-color: black;
      color: white;
      font-family: monospace;
      text-align: center;
      margin: 0;
      padding-bottom: 120px; /* コマンド固定領域の高さ分 */
    }
    .battle-container {
      width: 600px;
      margin: 0 auto;
      border: 2px solid white;
      padding: 10px;
      background-color: #222;
    }
    .enemy {
      margin: 10px 0;
    }
    .sido {
      display: grid;
      grid-template-columns: repeat(8, 20px);
      grid-template-rows: repeat(8, 20px);
      gap: 2px;
      margin: 10px auto;
      width: fit-content;
    }
    .pixel {
      width: 20px;
      height: 20px;
      background-color: transparent;
    }
    .blue { background-color: #3498db; }
    .red { background-color: #e74c3c; }
    .black { background-color: #222; }
    .white { background-color: #ecf0f1; }

    .status {
      text-align: left;
      margin: 10px auto;
      width: 90%;
    }

    #battle-log {
      height: 200px;
      overflow-y: scroll;
      background-color: #111;
      padding: 10px;
      text-align: left;
      border: 1px solid white;
      margin-bottom: 10px;
    }

    .commands {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #000;
      padding: 10px;
      border-top: 2px solid white;
    }

    .commands button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="battle-container">
    <div class="enemy">
      <h2>ハーゴン</h2>
      <div class="sido">
        <!-- ドット絵 -->
        <div class="pixel"></div><div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel"></div><div class="pixel"></div><div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel"></div>
        <div class="pixel blue"></div><div class="pixel red"></div><div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel red"></div><div class="pixel blue"></div>
        <div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel white"></div><div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel white"></div><div class="pixel blue"></div><div class="pixel blue"></div>
        <div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel"></div><div class="pixel black"></div><div class="pixel black"></div><div class="pixel"></div><div class="pixel blue"></div><div class="pixel blue"></div>
        <div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel red"></div><div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel red"></div><div class="pixel blue"></div><div class="pixel blue"></div>
        <div class="pixel blue"></div><div class="pixel"></div><div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel"></div><div class="pixel blue"></div>
        <div class="pixel"></div><div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel"></div><div class="pixel"></div><div class="pixel blue"></div><div class="pixel blue"></div><div class="pixel"></div>
        <div class="pixel"></div><div class="pixel"></div><div class="pixel blue"></div><div class="pixel"></div><div class="pixel"></div><div class="pixel blue"></div><div class="pixel"></div><div class="pixel"></div>
      </div>
      <p id="sido-status">HP: 255</p>
    </div>

    <div class="status" id="party-status"></div>
    <div id="battle-log">
      <p>ハーゴンがあらわれた！</p>
    </div>
  </div>

  <div class="commands" id="command-buttons"></div>

  <script>
    let sidoHP = 255;

    const party = {
      "ローレシア": { hp: 90, maxHp: 90 },
      "サマルトリア": { hp: 70, maxHp: 70 },
      "ムーンブルク": { hp: 60, maxHp: 60 }
    };

    function updatePartyStatus() {
      const status = document.getElementById("party-status");
      status.innerHTML = Object.entries(party).map(([name, data]) => {
        return `<p>${name}　HP: ${data.hp}/${data.maxHp}</p>`;
      }).join("");
    }

    function updateCommandButtons() {
      const commands = document.getElementById("command-buttons");
      commands.innerHTML = Object.entries(party).map(([name, data]) => {
        if (data.hp <= 0) {
          return `<button disabled>${name}は たおれている</button>`;
        } else {
          return `<button onclick=\"attack('${name}')\">${name}のこうげき</button>`;
        }
      }).join("");
    }

    function attack(character) {
      if (party[character].hp <= 0) return;

      const damage = Math.floor(Math.random() * 20) + 10;
      sidoHP -= damage;
      if (sidoHP < 0) sidoHP = 0;

      const log = document.getElementById("battle-log");
      log.innerHTML = `<p>${character}のこうげき！ ${damage}のダメージ！</p>` + log.innerHTML;
      document.getElementById("sido-status").textContent = `HP: ${sidoHP}`;

      if (sidoHP <= 0) {
        log.innerHTML = `<p>ハーゴンをたおした！！</p>` + log.innerHTML;
        document.getElementById("command-buttons").innerHTML = "<p>勝利！！</p>";
      } else {
        setTimeout(enemyTurn, 1000);
      }
    }

    function enemyTurn() {
      const alive = Object.keys(party).filter(name => party[name].hp > 0);
      if (alive.length === 0) return;

      const target = alive[Math.floor(Math.random() * alive.length)];
      const damage = Math.floor(Math.random() * 25) + 5;
      party[target].hp -= damage;
      if (party[target].hp < 0) party[target].hp = 0;

      const log = document.getElementById("battle-log");
      log.innerHTML = `<p>ハーゴンのこうげき！ ${target}に${damage}のダメージ！</p>` + log.innerHTML;

      updatePartyStatus();
      updateCommandButtons();
    }

    // 初期描画
    updatePartyStatus();
    updateCommandButtons();
  </script>
</body>
</html>
